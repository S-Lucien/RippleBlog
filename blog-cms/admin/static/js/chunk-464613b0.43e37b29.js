(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-464613b0"],{"14c33":function(t,e,n){"use strict";n("8d1c")},"1da1":function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));n("d3b7");function i(t,e,n,i,a,o,c){try{var s=t[o](c),r=s.value}catch(t){return void n(t)}s.done?e(r):Promise.resolve(r).then(i,a)}function a(t){return function(){var e=this,n=arguments;return new Promise((function(a,o){var c=t.apply(e,n);function s(t){i(c,a,o,s,r,"next",t)}function r(t){i(c,a,o,s,r,"throw",t)}s(void 0)}))}}},"8d1c":function(t,e,n){},9874:function(t,e,n){},ddbb:function(t,e,n){"use strict";n("9874")},eaf3:function(t,e,n){"use strict";n.r(e);var i=n("1da1"),a=(n("96cf"),n("a15b"),n("2ca0"),n("fb6a"),n("8a79"),n("d3b7"),n("159b"),n("b0c0"),n("ac1f"),n("5319"),n("4de4"),n("99af"),n("841c"),n("e9c4"),n("c00a")),o=n("c54a"),c=n("f988"),s=n("f43e"),r=n("40b3"),l=n.n(r),u={name:"TxyunManage",components:{SvgIcon:a.a},data:function(){var t,e=this;return{cos:{},txyunConfig:{secretId:"",secretKey:"",bucketName:"",region:"",domain:""},pathArr:[{value:"",label:"根目录"}],activePath:[""],pathProps:{lazy:!0,checkStrictly:!0,lazyLoad:(t=Object(i.a)(regeneratorRuntime.mark((function t(n,i){var a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return""!=(a=(a=n.path.join("/")).startsWith("/")?a.slice(1):a)&&(a=a.endsWith("/")?a:"".concat(a,"/")),o=[],t.next=6,e.getReposContents(o,a);case 6:i(o);case 7:case"end":return t.stop()}}),t)}))),function(e,n){return t.apply(this,arguments)})},hintShow1:!0,hintShow2:!0,fileList:[],isDrawerShow:!1,nameType:"1",uploadList:[],isCustomPath:!1,customPath:""}},computed:{realPath:function(){if(this.isCustomPath)return"".concat(this.customPath);var t=this.activePath.join("/");return""!=(t=t.startsWith("/")?t.slice(1):t)?"".concat(t,"/"):"".concat(t)}},created:function(){this.hintShow1=!localStorage.getItem("txyunHintShow1"),this.hintShow2=!localStorage.getItem("txyunHintShow2");var t=localStorage.getItem("txyunConfig");t?(this.txyunConfig=JSON.parse(t),this.txyunConfig.domain=this.txyunConfig.domain.endsWith("/")?this.txyunConfig.domain:"".concat(this.txyunConfig.domain,"/"),this.cos=new l.a({SecretId:this.txyunConfig.secretId,SecretKey:this.txyunConfig.secretKey})):(this.msgError("请先配置腾讯云"),this.$router.push("/pictureHosting/setting"))},methods:{getReposContents:function(t,e){var n=this;return Object(i.a)(regeneratorRuntime.mark((function i(){var a;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return a=n.txyunConfig,i.next=3,n.cos.getBucket({Bucket:a.bucketName,Region:a.region,Prefix:e,Delimiter:"/"}).then((function(n){n.CommonPrefixes.forEach((function(n){n.name=n.Prefix.replace(e,"").slice(0,-1),t.push({value:n.name,label:n.name,leaf:!1})}))}));case 3:case"end":return i.stop()}}),i)})))()},search:function(){var t=this.txyunConfig,e=[],n=this.activePath.join("/");""!=(n=n.startsWith("/")?n.slice(1):n)&&(n=n.endsWith("/")?n:"".concat(n,"/")),this.cos.getBucket({Bucket:t.bucketName,Region:t.region,Prefix:n,Delimiter:"/"}).then((function(i){i.Contents.filter((function(t){return!t.Key.endsWith("/")&&Object(o.b)(t.Key)})).forEach((function(i){i.path=i.Key,i.cdn_url="".concat(t.domain).concat(i.path),i.name=i.Key.replace(n,""),e.push(i)}))})),this.fileList=e},noDisplay:function(t){localStorage.setItem("txyunHintShow".concat(t),"1")},copy:function(t,e){var n="";1==t?n=e.cdn_url:2==t&&(n="![".concat(e.name,"](").concat(e.cdn_url,")")),Object(s.a)(n),this.msgSuccess("复制成功")},delFile:function(t){var e=this,n=this.txyunConfig;this.$confirm("此操作将永久删除该文件, 是否删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.cos.deleteObject({Bucket:n.bucketName,Region:n.region,Key:t.path}).then((function(){e.msgSuccess("删除成功"),e.search()})).catch((function(){e.msgError("删除失败")}))})).catch((function(){e.$message({type:"info",message:"已取消删除"})}))},submitUpload:function(){this.uploadList=this.$refs.uploadRef.uploadFiles,this.uploadList.length?this.$refs.uploadRef.submit():this.msgError("请先选择文件")},upload:function(t){var e=this,n=t.file.name;"2"===this.nameType&&(n=Object(c.a)()+n.substr(n.lastIndexOf(".")));var i=this.txyunConfig,a=this.realPath;a=(a=a.startsWith("/")?a.slice(1):a).endsWith("/")?a:"".concat(a,"/"),this.cos.uploadFile({Bucket:i.bucketName,Region:i.region,Key:"".concat(a).concat(n),Body:t.file,SliceSize:5242880,onProgress:function(t){console.log(JSON.stringify(t))}}).then((function(){e.msgSuccess("上传成功"),t.onSuccess()}))}}},h=(n("ddbb"),n("14c33"),n("2877")),f=Object(h.a)(u,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-row",[n("el-select",{staticStyle:{"min-width":"200px"},attrs:{disabled:""},model:{value:t.txyunConfig.bucketName,callback:function(e){t.$set(t.txyunConfig,"bucketName",e)},expression:"txyunConfig.bucketName"}}),n("el-cascader",{staticStyle:{"min-width":"450px"},attrs:{placeholder:"请选择目录",options:t.pathArr,props:t.pathProps},model:{value:t.activePath,callback:function(e){t.activePath=e},expression:"activePath"}}),n("el-button",{attrs:{type:"primary",size:"medium",icon:"el-icon-search"},on:{click:t.search}},[t._v("查询")]),n("el-button",{staticClass:"right-item",attrs:{type:"primary",size:"medium",icon:"el-icon-upload"},on:{click:function(e){t.isDrawerShow=!t.isDrawerShow}}},[t._v("上传")])],1),t.hintShow1?n("el-alert",{attrs:{title:"只显示<img>标签支持的 apng,avif,bmp,gif,ico,cur,jpg,jpeg,jfif,pjpeg,pjp,png,svg,tif,tiff,webp 格式的图片，见 https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/img",type:"warning","show-icon":"","close-text":"不再提示"},on:{close:function(e){return t.noDisplay(1)}}}):t._e(),t.hintShow2?n("el-alert",{attrs:{title:"最多显示100个文件",type:"warning","show-icon":"","close-text":"不再提示"},on:{close:function(e){return t.noDisplay(2)}}}):t._e(),n("el-row",{directives:[{name:"viewer",rawName:"v-viewer"}]},t._l(t.fileList,(function(e,i){return n("div",{key:i,staticClass:"image-container"},[n("el-image",{attrs:{src:e.cdn_url,fit:"scale-down"}}),n("div",{staticClass:"image-content"},[n("div",{staticClass:"info"},[n("span",[t._v(t._s(e.name))])]),n("div",{staticClass:"icons"},[n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制CDN链接",placement:"bottom"}},[n("i",{staticClass:"icon el-icon-link",on:{click:function(n){return t.copy(1,e)}}})]),n("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"复制MD格式",placement:"bottom"}},[n("SvgIcon",{attrs:{"icon-class":"markdown","class-name":"icon"},on:{click:function(n){return t.copy(2,e)}}})],1),n("i",{staticClass:"icon el-icon-delete",on:{click:function(n){return t.delFile(e)}}})],1)])],1)})),0),n("el-drawer",{attrs:{title:"上传文件",visible:t.isDrawerShow,direction:"rtl",size:"40%",wrapperClosable:!1,"close-on-press-escape":!1},on:{"update:visible":function(e){t.isDrawerShow=e}}},[n("el-row",[n("el-radio",{attrs:{label:"1"},model:{value:t.nameType,callback:function(e){t.nameType=e},expression:"nameType"}},[t._v("使用源文件名")]),n("el-radio",{attrs:{label:"2"},model:{value:t.nameType,callback:function(e){t.nameType=e},expression:"nameType"}},[t._v("使用UUID文件名")]),n("el-button",{directives:[{name:"throttle",rawName:"v-throttle",value:[t.submitUpload,"click",3e3],expression:"[submitUpload,`click`,3000]"}],attrs:{size:"small",type:"primary",icon:"el-icon-upload"}},[t._v("确定上传")])],1),n("el-row",[t._v(" 当前目录："+t._s(t.realPath)+" ")]),n("el-row",[n("el-switch",{attrs:{"active-text":"自定义目录"},model:{value:t.isCustomPath,callback:function(e){t.isCustomPath=e},expression:"isCustomPath"}}),n("el-input",{staticStyle:{"margin-top":"10px"},attrs:{placeholder:"例：oldFolder/newFolder/",disabled:!t.isCustomPath,size:"medium"},model:{value:t.customPath,callback:function(e){t.customPath=e},expression:"customPath"}})],1),n("el-upload",{ref:"uploadRef",attrs:{action:"","http-request":t.upload,drag:"",multiple:"","file-list":t.uploadList,"list-type":"picture","auto-upload":!1}},[n("i",{staticClass:"el-icon-upload"}),n("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),n("em",[t._v("点击上传")])])])],1)],1)}),[],!1,null,"36e30953",null);e.default=f.exports},f43e:function(t,e,n){"use strict";function i(t){var e=document.createElement("input");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("Copy"),e.remove()}n.d(e,"a",(function(){return i}))},f988:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));n("ac1f"),n("5319"),n("d3b7"),n("25f0");function i(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}}}]);